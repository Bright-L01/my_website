class c{metrics=null;performanceObserver=null;bundleUrl="";constructor(){this.bundleUrl=window.location.origin}async init(){typeof window>"u"||(this.startPerformanceMonitoring(),await this.analyzeBundleSize(),this.monitorResourceLoading(),this.logAnalysisResults())}startPerformanceMonitoring(){if("PerformanceObserver"in window){this.performanceObserver=new PerformanceObserver(e=>{const t=e.getEntries();this.processPerformanceEntries(t)});try{this.performanceObserver.observe({entryTypes:["navigation","resource","paint","largest-contentful-paint"]})}catch(e){console.warn("Performance monitoring not fully supported:",e)}}}processPerformanceEntries(e){e.forEach(t=>{switch(t.entryType){case"navigation":this.processNavigationEntry(t);break;case"resource":this.processResourceEntry(t);break;case"paint":this.processPaintEntry(t);break;case"largest-contentful-paint":this.processLCPEntry(t);break}})}processNavigationEntry(e){const t={dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ssl:e.connectEnd-e.secureConnectionStart,ttfb:e.responseStart-e.requestStart,download:e.responseEnd-e.responseStart,domParse:e.domComplete-e.domLoading,domReady:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,loadComplete:e.loadEventEnd-e.loadEventStart};console.log("Navigation Timing:",t)}processResourceEntry(e){const t={name:e.name,type:this.getResourceType(e.name),size:e.transferSize,duration:e.duration,cached:e.transferSize===0&&e.duration>0};t.duration>1e3&&!t.cached&&console.warn("Slow resource:",t),t.type==="script"&&t.size>1e5&&console.warn("Large JavaScript bundle:",t)}processPaintEntry(e){e.name==="first-contentful-paint"&&console.log("First Contentful Paint:",e.startTime)}processLCPEntry(e){console.log("Largest Contentful Paint:",e.startTime)}async analyzeBundleSize(){try{const e=performance.getEntriesByType("resource"),t=e.filter(o=>o.name.endsWith(".js")&&o.name.includes(this.bundleUrl)),n=e.filter(o=>o.name.endsWith(".css")&&o.name.includes(this.bundleUrl)),s=t.reduce((o,a)=>o+(a.transferSize||0),0),r=n.reduce((o,a)=>o+(a.transferSize||0),0);console.log("Bundle Analysis:",{javascript:this.formatBytes(s),css:this.formatBytes(r),total:this.formatBytes(s+r),files:{js:t.length,css:n.length}}),this.analyzeChunks(t)}catch(e){console.error("Bundle analysis failed:",e)}}analyzeChunks(e){e.forEach(t=>{const n={name:this.getChunkName(t.name),size:this.formatBytes(t.transferSize||0),loadTime:Math.round(t.duration),cached:t.transferSize===0&&t.duration>0};console.log("Chunk:",n)})}monitorResourceLoading(){const e=window.import;e&&(window.import=async t=>{const n=performance.now();try{const s=await e(t),r=performance.now();return console.log(`Dynamic import ${t}: ${Math.round(r-n)}ms`),s}catch(s){throw console.error(`Dynamic import failed for ${t}:`,s),s}})}generateRecommendations(){const e=[],t=this.getTotalBundleSize();t>244e3&&e.push({type:"warning",message:"Bundle size exceeds recommended limit",impact:"high",solution:"Consider code splitting and lazy loading",estimatedSavings:t-244e3}),this.hasUnusedCode()&&e.push({type:"info",message:"Potential unused code detected",impact:"medium",solution:"Use tree shaking and bundle analysis tools"});const n=this.getLargeDependencies();return n.length>0&&e.push({type:"warning",message:`Large dependencies detected: ${n.join(", ")}`,impact:"medium",solution:"Consider lighter alternatives or lazy loading"}),e}getTotalBundleSize(){return performance.getEntriesByType("resource").filter(t=>t.name.includes(this.bundleUrl)&&(t.name.endsWith(".js")||t.name.endsWith(".css"))).reduce((t,n)=>t+(n.transferSize||0),0)}hasUnusedCode(){return!1}getLargeDependencies(){return[]}getResourceType(e){return e.endsWith(".js")?"script":e.endsWith(".css")?"stylesheet":e.match(/\.(jpg|jpeg|png|gif|webp|svg)$/)?"image":e.match(/\.(woff|woff2|ttf|eot)$/)?"font":"other"}getChunkName(e){const t=e.match(/\/([^\/]+\.js)$/);return t?t[1]:"unknown"}formatBytes(e){if(e===0)return"0 B";const t=1024,n=["B","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return`${Math.round(e/Math.pow(t,s)*100)/100} ${n[s]}`}logAnalysisResults(){setTimeout(()=>{const e=this.generateRecommendations();e.length>0?(console.group("🔍 Bundle Analysis Recommendations"),e.forEach(t=>{const n=t.type==="error"?"❌":t.type==="warning"?"⚠️":"ℹ️";console.log(`${n} ${t.message}`),console.log(`   Impact: ${t.impact}`),console.log(`   Solution: ${t.solution}`),t.estimatedSavings&&console.log(`   Potential savings: ${this.formatBytes(t.estimatedSavings)}`)}),console.groupEnd()):console.log("✅ Bundle analysis: No major issues detected")},3e3)}getPerformanceReport(){const e=performance.getEntriesByType("navigation")[0],t=performance.getEntriesByType("resource");return{navigation:{loadTime:e.loadEventEnd-e.navigationStart,domReady:e.domContentLoadedEventEnd-e.navigationStart,firstByte:e.responseStart-e.navigationStart},resources:{total:t.length,totalSize:this.formatBytes(t.reduce((n,s)=>n+(s.transferSize||0),0)),cached:t.filter(n=>n.transferSize===0&&n.duration>0).length},recommendations:this.generateRecommendations()}}cleanup(){this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=null)}}export{c as default};

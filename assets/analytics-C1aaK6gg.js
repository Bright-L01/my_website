class o{sessionId;events=[];interactions=[];metrics={};isEnabled=!0;constructor(){this.sessionId=this.generateSessionId(),this.initializeTracking()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}initializeTracking(){typeof window>"u"||(this.trackPageLoad(),this.trackCoreWebVitals(),this.trackUserInteractions(),this.trackErrors(),this.startPeriodicReporting())}trackPageLoad(){window.addEventListener("load",()=>{const t=performance.getEntriesByType("navigation")[0];t&&(this.metrics.domContentLoaded=t.domContentLoadedEventEnd-t.domContentLoadedEventStart,this.metrics.loadTime=t.loadEventEnd-t.loadEventStart,this.metrics.ttfb=t.responseStart-t.requestStart)})}trackCoreWebVitals(){new PerformanceObserver(r=>{const n=r.getEntries(),a=n[n.length-1];this.metrics.lcp=a.startTime,this.trackEvent("core_web_vital",a.startTime,{metric:"lcp"})}).observe({type:"largest-contentful-paint",buffered:!0}),new PerformanceObserver(r=>{const n=r.getEntries(),a=n[n.length-1];this.metrics.fcp=a.startTime,this.trackEvent("core_web_vital",a.startTime,{metric:"fcp"})}).observe({type:"paint",buffered:!0});let e=0;new PerformanceObserver(r=>{for(const n of r.getEntries())n.hadRecentInput||(e+=n.value);this.metrics.cls=e,this.trackEvent("core_web_vital",e,{metric:"cls"})}).observe({type:"layout-shift",buffered:!0}),this.trackINP()}trackINP(){let t=0;const s=e=>{const i=performance.now();requestAnimationFrame(()=>{const n=performance.now()-i;n>t&&(t=n,this.metrics.inp=n,this.trackEvent("core_web_vital",n,{metric:"inp"}))})};["click","keydown","pointerdown"].forEach(e=>{document.addEventListener(e,s,{passive:!0})})}trackUserInteractions(){document.addEventListener("click",s=>{const e=s.target;this.trackInteraction("click",this.getElementSelector(e),{tagName:e.tagName,className:e.className,text:e.textContent?.substring(0,50)})});let t;document.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>{this.trackInteraction("scroll","window",{scrollY:window.scrollY,scrollPercentage:Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100)})},100)}),document.addEventListener("submit",s=>{const e=s.target;this.trackInteraction("form_submit",this.getElementSelector(e),{formId:e.id,formAction:e.action})}),document.addEventListener("input",s=>{const e=s.target;(e.type==="search"||e.id==="project-search")&&this.trackInteraction("search",this.getElementSelector(e),{query:e.value,queryLength:e.value.length})})}trackErrors(){window.addEventListener("error",t=>{this.trackEvent("error",0,{message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,stack:t.error?.stack})}),window.addEventListener("unhandledrejection",t=>{this.trackEvent("promise_rejection",0,{reason:t.reason,stack:t.reason?.stack})})}getElementSelector(t){return t.id?`#${t.id}`:t.className?`.${t.className.split(" ")[0]}`:t.tagName.toLowerCase()}trackEvent(t,s,e){if(!this.isEnabled)return;const i={name:t,value:s,data:e,timestamp:Date.now(),sessionId:this.sessionId};this.events.push(i),this.events.length>100&&(this.events=this.events.slice(-100))}trackInteraction(t,s,e){if(!this.isEnabled)return;const i={type:t,target:s,timestamp:Date.now(),sessionId:this.sessionId,data:e};this.interactions.push(i),this.interactions.length>50&&(this.interactions=this.interactions.slice(-50))}startPeriodicReporting(){setInterval(()=>{this.sendAnalyticsData()},3e4),window.addEventListener("beforeunload",()=>{this.sendAnalyticsData()})}sendAnalyticsData(){if(!this.isEnabled||this.events.length===0)return;const t={sessionId:this.sessionId,timestamp:Date.now(),metrics:this.metrics,events:this.events,interactions:this.interactions,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},url:window.location.href};console.log("ðŸ“Š Analytics Data:",t),this.events=[],this.interactions=[]}trackCustomEvent(t,s,e){this.trackEvent(t,s,e)}trackPageView(t){this.trackEvent("page_view",0,{page:t,url:window.location.href})}trackProjectView(t){this.trackEvent("project_view",0,{projectId:t})}trackProjectExpand(t){this.trackEvent("project_expand",0,{projectId:t})}trackContactFormSubmit(t){this.trackEvent("contact_form_submit",t?1:0)}trackResumeDownload(t){this.trackEvent("resume_download",0,{format:t})}trackSectionView(t){this.trackEvent("section_view",0,{sectionId:t})}getMetrics(){return{...this.metrics}}getSessionId(){return this.sessionId}disable(){this.isEnabled=!1}enable(){this.isEnabled=!0}}const d=new o;export{o as AnalyticsService,d as analytics,d as default};
